#!/bin/sh

echo "\033[33mğŸƒâ€â™‚ï¸ Running pre-commit hooks...\033[0m"

# lint-staged ì‹¤í–‰
echo "\033[34mğŸ“ Running lint-staged...\033[0m"
pnpm lint-staged || {
    echo "\033[31mâŒ Lint-staged failed. Please fix the errors and try again.\033[0m"
    exit 1
}

#ë³€ê²½ëœ íŒŒì¼ ì›Œí¬ìŠ¤í˜ì´ìŠ¤ ì°¾ê¸°
CHANGED_FILES=$(git diff --cached --name-only)

# APIì„œë²„ í…ŒìŠ¤íŠ¸
if echo "$CHANGED_FILES" | grep -q "^apps/api/"; then
    echo "\033[34mğŸ§ª Running API tests...\033[0m"
    pnpm test:api || {
        echo "\033[31mâŒ API tests failed. Please fix the failing tests and try again.\033[0m"
        exit 1
    }
fi

# Chatì„œë²„ í…ŒìŠ¤íŠ¸
if echo "$CHANGED_FILES" | grep -q "^apps/chat/"; then
    echo "\033[34mğŸ§ª Running Chat tests...\033[0m"
    pnpm test:chat || {
        echo "\033[31mâŒ Chat tests failed. Please fix the failing tests and try again.\033[0m"
        exit 1
    }
fi

# Mediaì„œë²„ í…ŒìŠ¤íŠ¸
if echo "$CHANGED_FILES" | grep -q "^apps/media/"; then
    echo "\033[34mğŸ§ª Running Media tests...\033[0m"
    pnpm test:media || {
        echo "\033[31mâŒ Media tests failed. Please fix the failing tests and try again.\033[0m"
        exit 1
    }
fi

echo "\033[32mâœ… All pre-commit checks passed!\033[0m"